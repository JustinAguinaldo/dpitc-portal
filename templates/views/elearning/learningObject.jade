extends ../../layouts/elearning

block js
  script.
    function checkSubmit(e){
      if(e && e.keyCode == 13)
        document.commentForm.submit();
        document.commentForm.clear();
    }
    //- document.commentForm.submit();

mixin learningObject(currLO)
  .container-fluid
    .row
      if currLO.video
        .col-md-8.embed-responsive-item
          iframe(width="640", height="360", src="https://www.youtube.com/embed/"+currLO.video.videoId, frameborder="0", allowfullscreen)
    //- .row
      if currLO.gallery
        h3 Gallery
        each image in currLO.gallery.images
          img(src=image.)
    .row
      if currLO.links.exists
        h3 Related Articles:
        each link in currLO.links
          a(href=link.url) #{link.name}   
    .row
      p.text-info Uploaded: #{currLO.publishedAt.toDateString()}
    .row
      p= currLO.content.extended
      br
    //- .row
      p Related: &nbsp;
      each tag in currLO.tags
        span.label.label-info  #{tag} &nbsp;


mixin recommendedTopics(recLO)
  each lo in recLO
    .media
      .media-left
        if lo.thumbnail.exists
          a(href=lo.url)
            img(src=lo._.thumbnail.limit(100, 100) alt=lo.video.title).img-rounded
        else
          a(href=lo.url)
            img(src="/images/image-not-available.png", alt=lo.title, height="100px", weight="100px").img-rounded
      .media-body
        a(href=lo.url)
          h5=lo.title
          span= lo.content.brief.substring(0, 50)

mixin otherTopics(otherLO)
  each lo in otherLO
    .media
      .media-left
        if lo.thumbnail.exists
          a(href=lo.url)
            img(src=lo._.thumbnail.limit(100, 100) alt=lo.video.title).img-rounded
        else
          a(href=lo.url)
            img(src="/images/image-not-available.png", alt=lo.title, height="100px", weight="100px").img-rounded
      .media-body
        a(href=lo.url)
          h5=lo.title
          span= lo.content.brief.substring(0, 50)

block addComment
  form.contact-form(method="post" name="commentForm")
    .row
      input(type="hidden" name="action" value="user.addComment")
      .form-group
        .row
          input.form-control(type="text" name="content" placeholder="Write a comment..." value=formData.content)
        div(onKeyPress="return checkSubmit(event)")
        //- input(type="submit" style="display:none")
    //- .row.pull-right       
      button(type="submit").btn.btn-primary 
        span.glyphicon.glyphicon-comment(aria-hidden="true")

mixin viewComments(comments)
  label Comments
  if comments
    each comment in comments
      ul.list-group
        li.list-group-item
          blockquote
            strong 
            p #{comment.content}
            footer #{comment.author.name.first} #{comment.author.name.last} on #{comment.dateCreated.toDateString()}

block content
  .container
    .row
      .col-md-8
        .row
          .panel.panel-info
            .panel-body
              +learningObject(data.currLO)
              +viewComments(data.comments)
              block addComment
              
          //- .panel-footer
            p.text-info.text-right Author: #{data.currLO.author.name.last}, #{data.currLO.author.name.first}

      .col-md-4
        .row
          .panel.panel-info
            .panel-heading Recommended Topics
            .panel-body
              +recommendedTopics(data.recommendedLO)
        .row
          .panel.panel-info
            .panel-heading 
              a(href="/elearning/courses") Other Topics
            .panel-body
              +otherTopics(data.otherLO)