extends ../../layouts/elearning

block css
  link(rel="stylesheet", href="/js/fancybox/jquery.fancybox.css", type="text/css", media="screen")

block js
  //- For Gallery
  script(src="/js/fancybox/jquery.fancybox.pack.js")
  script.
    jQuery(function($) {
      $('.gallery-image').fancybox({
        prevEffect: 'none',
        nextEffect: 'none',
        closeBtn: false,
        helpers: {
          titl: {},
          buttons: {}
        }
      });
    });

  //- For Comments
  script.
    jQuery(function($) {
      
      var comments = $('#comments');
      var input = $('.comment-field-input');
      var submit = comments.find('button[type=submit]');

      
      // Scroll to comments and focus input field
      function scrollToComments(e) {
        
        e.preventDefault();
        
        $('html, body').animate({ scrollTop: comments.offset().top }, 250);
        
        input.eq(0).focus();
      }
      $('[href="#comments"]').click( scrollToComments );
      
      // Check if field has content: enable/disable submit. Disable by default
      submit.attr('disabled','disabled');
      input.keyup(function() {
        if ($.trim($(this).val())) {
          submit.removeAttr('disabled');
        } else {
          submit.attr('disabled','disabled');
        }
      });
    });

    

mixin files(files)
  .row
    label Files in #{currentLO.title}
  .row.equal-height
    if files.length
      each file in files
        .col-xs-12.col-md-4
          .thumbnail
            embed(src='/uploads/elearning/files/'+file.file.filename, width='100%' height='200px', type='application/pdf')
            .caption
              a(href='/uploads/elearning/files/'+file.file.filename,) #{file.name}
         


mixin gallery(gallery)
  .row
    label Photo Gallery
  .row
    if gallery.images.length
      each image, i in gallery.images
        .col-xs-6.col-sm-4.col-md-4(style='margin-bottom: 30px;')
          a(href=image.limit(900,600), title=gallery.name+' image '+(i+1), rel=gallery.key).gallery.image
            img(src=image.fill(300,300), alt=gallery.name+' image '+(i+1)).img-thumbnail

  
mixin video(video)
  .row
    label #{video.title}
  .row
    .col-md-8.embed-responsive-item
      if video.videoId
        iframe(width="640", height="360", src="https://www.youtube.com/embed/"+video.videoId, frameborder="0", allowfullscreen)
      
      else
        p Video link seems to be broken.
  hr
  .row
    .col-md-8
      if video.description
        p #{video.description}

mixin links(links)
  .row
    label Related Links
  .row
    .col-xs-12.col-sm-12.col-md-12
      if links.length
        .list-group
          each link in links
            a.list-group-item(href=link.url) 
              h4.list-group-heading #{link.name}
              p.list-group-item-text !{link.description}


mixin tags(action)

mixin learningObject(currentLO)
  .row
    h3 #{currentLO.title}
    | !{currentLO.content.full}
  .row
    if currentLO.author.length
      p Source/s:
      each au in currentLO.author
        a(href='#')= au.name
  


mixin comment-form(action)
  form(method='post', style="margin-bottom: 10px; margin-top: 10px;")
    input(type='hidden', name='action', value='comment.create')
    .media
      .pull-left
        if user
          img(src=user.photo.exists ? user._.photo.thumbnail(80,80) : 'http://placehold.it/80x80', alt=user.name.full, width=80, height=80).img-rounded
        else
          img(src='http://placehold.it/80x80', alt='Comment author placeholder', width=80, height=80).img-rounded
      .media-body
        textarea(name='content', placeholder=user ? 'Leave a comment...' : 'Please sign in to comment', disabled=!user, style="margin-bottom: 10px; min-height: 80px; resize: vertical;").form-control
        if user
          button(type='submit').btn.btn-primary.pull-right Add Comment
        else
          ul.list-inline
            li: a(href='/keystone/signin').btn.btn-sm.btn-primary Sign in to Comment

mixin comment-post(comment)
  if comment.author
    div(id='comment-id-' + comment.id, style="margin-top: 20px;")
      .media
        .pull-left
          img(src=comment.author.photo.exists ? comment.author._.photo.thumbnail(80,80) : 'http://placehold.it/80x80', alt=comment.author.name.full, width=80, height=80).img-rounded
        .media-body
          p.list-group-item-heading
            strong= comment.author.name.full
            if user && user.id === comment.author.id
              |  &middot; 
              a(href='?remove=comment&comment=' + comment.id, title='Delete this comment', rel='tooltip', data-placement='left').comment-delete.js-delete-confirm Delete
          p.list-group-item-text=comment.content.replace(/\n/g, '<br>')

mixin comment-thread(comments)
  +comment-form() 
  hr
  if comments.length
    for comment in comments
      +comment-post(comment)
      

mixin reactions(action)
  .row
    p.text-right Views
      span.badge  #{currentLO.loviews.length} 
    .col-md-1.col-md-push-8.col-xs-1.col-xs-push-8
      form(method='post', style="margin: 0px;")
        input(type='hidden', name='action', value='reactions.addLike')    
        button(type='submit').btn.btn-link.btn-lg #{currentLO.likes.length} &nbsp;
          i.fa.fa-thumbs-o-up.fa-lg(aria-hidden="true")
    
    .col-md-1.col-md-push-8.col-xs-1.col-xs-push-8
      form(method='post', style="margin: 0px;")
        input(type='hidden', name='action', value='reactions.addHappy')
        button(type='submit').btn.btn-link.btn-lg #{currentLO.happy.length} &nbsp;
          i.fa.fa-smile-o.fa-lg(aria-hidden="true")
  
    .col-md-1.col-md-push-8.col-xs-1.col-xs-push-8
      form(method='post', style="margin: 0px;")
        input(type='hidden', name='action', value='reactions.addSad')
        button(type='submit').btn.btn-link.btn-lg #{currentLO.sad.length} &nbsp;
          i.fa.fa-frown-o.fa-lg(aria-hidden="true")

mixin recommendedTopics(recLO)
  each lo in recLO
    .media
      .media-left
        if lo.thumbnail.exists
          a(href=lo.url + "?type=recommended")
            img(src=lo._.thumbnail.limit(100, 100) alt=lo.video.title).img-rounded
        else
          a(href=lo.url + "?type=recommended")
            img(src="http://placehold.it/100x100", alt=lo.title, height="100px", weight="100px").img-rounded
      .media-body
        a(href=lo.url + "?type=recommended")
          h5=lo.title
          span= lo.content.brief.substring(0, 50)

mixin otherTopics(otherLO)
  each lo in otherLO
    .media
      .media-left
        if lo.thumbnail.exists
          a(href=lo.url)
            img(src=lo._.thumbnail.limit(100, 100) alt=lo.video.title).img-rounded
        else
          a(href=lo.url)
            img(src="http://placehold.it/100x100", alt=lo.title, height="100px", weight="100px").img-rounded
      .media-body
        a(href=lo.url)
          h5=lo.title
          span= lo.content.brief.substring(0, 50)

    

block content
  .container
    .row
      .col-md-8
        .row
          //- Main Content and Reactions Panel
          .panel.panel-info
            .panel-body
              +learningObject(currentLO)
              hr
              +reactions()
        .row
          if currentLO.video
            .panel.panel-info
              .panel-body
                +video(currentLO.video)
        .row
          //- Gallery Panel
          if currentLO.gallery
            .panel.panel-info
              .panel-body
                +gallery(currentLO.gallery)

        .row
          //- Files Panel
          if currentLO.files.length
            .panel.panel-info
              .panel-body
                +files(currentLO.files)

        .row
          //- Related Links
          if currentLO.links.length
            .panel.panel-info
              .panel-body
                +links(currentLO.links)

        .row
          //- Comments Panel
          .panel.panel-info
            .panel-body
              label Comments (#{comments.length})
              +comment-thread(comments)
              
      .col-md-4
        .row
          .panel.panel-info
            .panel-heading Recommended Topics
            .panel-body
              +recommendedTopics(data.recommendedLO)
        .row
          .panel.panel-info
            .panel-heading 
              a(href="/elearning/courses") Other Topics
            .panel-body
              +otherTopics(data.otherLO)